<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <title>Docker - A worthwhale tool to know!</title>

        <!-- Materialize -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

        <link rel="stylesheet" href="css/reveal.min.css">
        <link rel="stylesheet" href="css/theme.css">

        <!-- Theme used for syntax highlighting of code -->
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.14.2/build/styles/railscasts.min.css">
    </head>
    <body>
        <div class="reveal">
            <div class="slides">
                <!-- Cover Image -->
                <section>
                    <img src="http://www.new-corner.com/wp-content/uploads/2014/12/docker-wallpaper-black-1050x656.jpg" alt="Docker">
                </section>

                <!-- Title Slide -->
                <section>
                    <h1>Docker</h1>
                    <h2>A worth<em>whale</em> tool to learn</h2>
                </section>
                <!-- /Title -->

                <!-- Roadmap -->
                <section>
                    <h2>Roadmap</h2>
                    <div class="fragment">
                        <strong>Part 1</strong>
                        Intro to Docker / Containers
                        <hr />
                    </div>
                    <div class="fragment">
                        <strong>Part 2</strong>
                        Getting Started with Docker
                        <hr />
                    </div>
                    <div class="fragment">
                        <strong>Part 3</strong>
                        Cool Docker Stuff
                        <hr />
                    </div>
                    <div class="fragment">
                        <strong>Part 4</strong>
                        Spilling Company Secrets
                        <hr />
                    </div>
                </section>
                <!-- /Roadmap -->

                <!-- Part 1; Intro to Docker -->
                <section>
                    <!-- Root -->
                    <section>
                        <img src="https://cdn-images-1.medium.com/max/1600/1*CO20-3P183ZAqrsJlF7n_A.png" width="800" height="555" alt="Cute Docker Whale with a Gopher" />
                        <h2>1. What is Docker?</h2>
                    </section>
                    <!-- /root -->

                    <!-- Docker -->
                    <section>
                        <em>Containers</em>
                    </section>
                    <!-- /Docker -->

                    <!-- Container -->
                    <section>
                        <h2>What is a Container?</h2>
                        <blockquote cite="https://www.docker.com/resources/what-container">
                            <span class="fragment">A standardized unit of software</span>
                        </blockquote>
                    </section>
                    <!-- /Container -->

                    <!-- VM Architecture -->
                    <section>
                        <img src="https://www.docker.com/sites/default/files/d8/2018-11/container-vm-whatcontainer_2.png" height="650" width="auto" alt="VM Architecture" />
                    </section>
                    <!--/ VM Architecture -->

                    <!-- Container Architecture -->
                    <section>
                        <img src="https://www.docker.com/sites/default/files/d8/2018-11/docker-containerized-appliction-blue-border_2.png" height="650" width="auto" alt="Container Architecture" />
                    </section>
                    <!--/ Container Architecture -->
                </section>
                <!-- /Part 1 -->

                <!-- Analogy -->
                <section>
                    <!-- Setup -->
                    <section>
                        <h2>Analogy</h2>
                        <div class="fragment">
                            Installing an application on a VM is like manually setting up a tent
                            <hr />
                        </div>
                        <div class="fragment">
                            Installing an application with Docker is like a popup tent
                            <hr />
                        </div>
                        <div class="fragment">
                            We'll ignore taking down the tents for the purposes of this analogy
                            <hr />
                        </div>
                    </section>
                    <!-- /setup -->

                    <!-- Explanation pt1 -->
                    <section>
                        <h2>Explanation Part 1; Manual Tent</h2>
                        <div class="fragment">
                            Imagine the ground is a nice clean VM that we just made
                            <hr />
                        </div>
                        <div class="fragment">
                            We gotta set up the tent poles (requirements) and the fabric (the application)
                            <hr />
                        </div>
                        <div class="fragment">
                            Putting tent poles into tent fabric is hard and might take multiple people
                            <hr />
                        </div>
                        <div class="fragment">
                            If the poles break / need upgrading it's hard to do
                            <hr />
                        </div>
                    </section>
                    <!-- /explanation pt1 -->

                    <!-- Explanation pt2 -->
                    <section>
                        <h2>Explanation Part 2; Popup Tent</h2>
                        <div class="fragment">
                            Imagine the ground is (again) a nice clean VM that we just made
                            <hr />
                        </div>
                        <div class="fragment">
                            We have to install 1 (usually) thing on it; Docker <em class="fragment">(no analogy here sorry)</em>
                            <hr />
                        </div>
                        <div class="fragment">
                            The tent is in its bag (Docker image) ready to be opened
                            <hr />
                        </div>
                        <div class="fragment">
                            We open the bag and the popup tent sets itself up for us (Docker container)
                            <hr />
                        </div>
                    </section>
                    <!-- /explanation pt2 -->

                    <!-- pop up tent gif -->
                    <section>
                        <h2>Close Enough</h2>
                        <video controls>
                            <source src="https://zippy.gfycat.com/BelovedCaringClumber.webm" type="video/webm" />
                        </video>
                    </section>
                    <!-- /pop up tent gif -->
                </section>

                <!-- Getting Started -->
                <section>
                    <!-- Root -->
                    <section>
                        <h2>2. Let's talk about Docker</h2>
                        <img src="https://docs.docker.com/get-started/images/laurel-docker-containers.png" width="auto" height="500" alt="Docker Harbour with Friends" />
                    </section>
                    <!-- /root -->

                    <!-- One more mention of tents -->
                    <section>
                        <h2>One more mention of tents</h2>
                        <div class="fragment">
                            Back in the dumb tent analogy I mentioned <em>Images</em> and <em>Containers</em>
                            <hr />
                        </div>
                        <div class="fragment">
                            <em>Images</em> are a built application (or whatever) ready to be run by Docker
                            <hr />
                        </div>
                        <div class="fragment">
                            <em>Containers</em> are running instances of <em>Images</em>
                            <hr />
                        </div>
                        <div class="fragment">
                            I'm now done talking about tents
                            <hr />
                        </div>
                    </section>
                    <!-- /tents -->

                    <!-- Installing docker -->
                    <section>
                        <h2>Let's Install Docker</h2>
                        <p>For Windows / Mac Users;</p>
                        <a href="https://docs.docker.com/engine/installation/" target="_blank">Install Guide</a>
                        <hr />
                        <p>
                            For (most) Linux Users;
                            <pre><code>curl -sSL https://get.docker.com/ | sh</code></pre>
                            For Arch users; it's in the community repo so just install it with whatever it is you use
                        </p>
                    </section>
                    <!-- /installation -->

                    <!-- hello-world -->
                    <section>
                        <h2>Even Docker isn't safe from "Hello, World!"</h2>
                        <p>Once you have it installed;</p>
                        <pre><code data-trim data-language="bash">docker run hello-world</code></pre>
                        <p>should contain the following output;</p>
                        <pre style="width: 100%;"><code data-trim>
                            Hello from Docker!
                            This message shows that your installation appears to be working correctly.
                        </code></pre>
                    </section>
                    <!-- /hello-world -->
                </section>
                <!-- /Getting Started -->

                <!-- Building our own Docker Image -->
                <section>
                    <!-- Discussion on images -->
                    <section>
                        <h2>2.5 More on Images</h2>
                        <p class="fragment">In the output of the last command I gave you, you might have seen something like this;</p>
                        <pre class="fragment" style="width: 100%;"><code data-trim data-language="bash">
                            Unable to find image 'hello-world:latest' locally
                            latest: Pulling from library/hello-world
                        </code></pre>
                        <p class="fragment">
                            This is Docker saying <br/> "I don't have the 'hello-world' image on this machine, let me go get it"
                        </p>
                    </section>
                    <!-- /Discussion -->

                    <!-- hub -->
                    <section>
                        <h2>Where does it get images?</h2>
                        <p class="fragment"><em>If only there was some kind of website where people could upload Docker images for various widely used applications...</em></p>
                    </section>
                    <!-- /hub -->

                    <!-- hub image -->
                    <section>
                        <h2>The Docker Hub!</h2>
                        <img src="img/hub.png" width="auto" height="500" alt="Docker Hub" />
                    </section>
                    <!-- /hub image -->

                    <!-- building our own images -->
                    <section>
                        <h2>2.8 Building our own images</h2>
                        <div class="fragment">
                            <em>"So the Docker Hub is great but it doesn't have Docker images for my stuff"</em>
                            <hr />
                        </div>
                        <div class="fragment">
                            Of course it doesn't, it's on you to make images for your stuff
                            <hr />
                        </div>
                        <div class="fragment">
                            How? Let me show you!
                            <hr />
                        </div>
                    </section>
                    <!-- /building our own images -->
                </section>
                <!-- /Building our own -->

                <!-- freyamade -->
                <section>
                    <!-- intro -->
                    <section>
                        <h2>Example: <code>techtalks-flask</code></h2>
                        <div class="fragment">
                            I have a nice website at <a href="http://freyamade.netsoc.co" target="_blank">freyamade.netsoc.co</a>
                            <hr />
                        </div>
                        <div class="fragment">
                            I want to make a standalone version using <code>flask</code>
                            <hr />
                        </div>
                        <div class="fragment">
                            I want to use Docker to deploy it
                            <hr />
                        </div>
                        <div class="fragment">
                            I guarantee nobody has made one for me since it's a new project
                            <hr />
                        </div>
                        <a href="https://github.com/freyamade/techtalks-flask" target="_blank" class="fragment">Follow Along</a>
                    </section>
                    <!-- /intro -->

                    <!-- step 1 -->
                    <section>
                        <h2>Step 1: Dockerfile</h2>
                        <div class="fragment">
                            First thing's first, we need a Dockerfile
                            <hr />
                        </div>
                        <div class="fragment">
                            This is a set of instructions for Docker to follow to build my image
                            <hr />
                        </div>
                        <div class="fragment">
                            We need to copy the code into the image, install requirements, and set the command that the image will run
                            <hr />
                        </div>
                    </section>
                    <!-- /step 1 -->

                    <!-- Dockerfile -->
                    <section>
                        <h2>Step 1: Dockerfile</h2>
                        <pre><code data-trim data-language="Dockerfile">
                            # Base image is the python 3.7 docker image
                            FROM python:3.7

                            # Set the working directory inside the image
                            WORKDIR /home/freyamade/public_html

                            # Copy from the build context to the image
                            COPY . .

                            # Install requirements
                            RUN pip install -r requirements.txt

                            # Load the latest submodules
                            RUN git submodule init
                            RUN git submodule update --remote

                            # Expose port 5000
                            EXPOSE 5000

                            # Set the entrypoint (CMD also works here)
                            ENTRYPOINT python3.7 app.py
                        </code></pre>
                    </section>
                    <!-- /Dockerfile -->

                    <!-- step 2 -->
                    <section>
                        <h2>Step 2: Building the image</h2>
                        <div class="fragment">
                            Now that we have a Dockerfile, we can build our own image
                            <hr />
                        </div>
                        <div class="fragment">
                            In our project directory we can run the following;
                            <hr />
                        </div>
                        <div class="fragment">
                            <pre><code data-lang="bash">docker build -t techtalks-flask .</code></pre>
                            <hr />
                        </div>
                    </section>
                    <!-- /step 2 -->

                    <!-- step 3 -->
                    <section>
                        <h2>Step 3: Running the image</h2>
                        <div class="fragment">
                            After building our image, we can verify it is there using;
                            <hr />
                        </div>
                        <div class="fragment">
                            <pre><code data-lang="bash">docker images</code></pre>
                            <hr />
                        </div>
                        <div class="fragment">
                            To then run the image we need to do the following;
                            <hr />
                        </div>
                        <div class="fragment">
                            <pre style="width: 100%;"><code data-lang="bash">docker run -p 5000:5000 -d techtalks-flask</code></pre>
                            <hr />
                        </div>
                    </section>
                    <!-- /step 3 -->

                    <!-- step 4 -->
                    <section>
                        <h2>Step 4: Test</h2>
                        <div class="fragment">
                            To test, go to <a href="http://localhost:5000" target="_blank">localhost:5000</a> and ensure the page loads
                            <hr />
                        </div>
                        <div class="fragment">
                            Last time <em>I</em> checked, it works, so if it doesn't for you it's your fault &gt;.&gt;
                            <hr />
                        </div>
                        <div class="fragment">
                            Also you can use the following command to list all running containers;
                            <hr />
                        </div>
                        <div class="fragment">
                            <pre style="width: 100%;"><code data-lang="bash" data-trim>
                                # show running containers
                                docker ps

                                # show all containers, dead or alive
                                docker ps -a
                            </code></pre>
                            <hr />
                        </div>
                    </section>
                    <!-- /step 4 -->
                </section>
                <!-- /freyamade -->

                <!-- other cool stuff -->
                <section>
                    <!-- root -->
                    <section>
                        <h2>0.2 Some other cool stuff</h2>
                        <p>Before I spill some company secrets, I want to share a couple of other cool things with you</p>
                    </section>
                    <!-- /root -->

                    <!-- -v -->
                    <section>
                        <h2><code>-v</code></h2>
                        <div class="fragment">
                            Run this from the project directory;
                            <hr />
                        </div>
                        <div class="fragment">
                            <pre style="width: 100%;"><code data-lang="bash">docker run -p 5000:5000 -v $(pwd):/home/freyamade/public_html -d freyamade</code></pre>
                            <hr />
                        </div>
                        <div class="fragment">
                            Now edit <code>templates/index.html</code>, reload the page and you'll see it update in real time!
                            <hr />
                        </div>
                        <div class="fragment">
                            This is handy if you have your application Dockerised already and want to do development work
                            <hr />
                        </div>
                    </section>
                    <!-- /-v -->

                    <!-- webdev -->
                    <section>
                        <h2><code>-v</code> + web development</h2>
                        <div class="fragment">
                            Working on a new web project but don't want to install Apache on your machine to test?
                            <hr />
                        </div>
                        <div class="fragment">
                            <pre style="width: 100%;"><code data-lang="bash" data-trim>
                                # Run from inside project directory, then go to localhost:8080
                                docker run -v $(pwd):/usr/local/apache2/htdocs/ -p 8080:80 -d httpd
                            </code></pre>
                            <hr />
                        </div>
                    </section>
                    <!-- /webdev -->

                    <!-- compose -->
                    <section>
                        <h2>Compose</h2>
                        <div class="fragment">
                            What if you have an application with a lot of required external services (sql, load balancer, etc)?
                            <hr />
                        </div>
                        <div class="fragment">
                            You could set up all the containers yourself manually...
                            <hr />
                        </div>
                        <div class="fragment">
                            Or you could use Docker Compose (installed separately)
                            <hr />
                        </div>
                    </section>
                    <!-- /compose -->

                    <!-- techtalks-flask + compose -->
                    <section>
                        <h2><code>techtalks-flask</code> + Compose</h2>
                        <p class="fragment">Let's say I add some reason to use <code>redis</code> in the <code>techtalks-flask</code> project.</p>
                        <p class="fragment">I could have the following compose file;</p>
                        <pre class="fragment"><code data-trim data-language="YAML">
                            version: '3'
                            services:
                              web:
                                image: "techtalks-flask"
                                ports:
                                 - "5000:5000"
                              redis:
                                image: "redis:alpine"
                        </code></pre>
                        <p class="fragment">And then bring up both images using;</p>
                        <pre class="fragment"><code data-lang="bash">docker-compose up -d</code></pre>
                    </section>
                    <!-- /techtalks-flask + compose -->

                    <!-- k8s -->
                    <section>
                        <h2>Kubernetes</h2>
                        <blockquote cite="https://kubernetes.io" class="fragment">
                            Kubernetes (k8s) is an open-source system for automating deployment, scaling, and management of containerized applications.
                        </blockquote>
                    </section>
                    <!-- /k8s -->

                    <!-- dockerdoom -->
                    <section>
                        <h2>Docker DOOM</h2>
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/E1Lm1NFthX8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </section>
                    <!-- /dockerdoom -->
                </section>
                <!-- /other cool stuff -->

                <!-- trade secrets -->
                <section>
                    <!-- intro -->
                    <section>
                        <h2>3. Let's spill some trade secrets</h2>
                        <img src="https://www.mundodocker.com.br/wp-content/uploads/2017/02/docker_secrets.png" width="auto" height="500" alt="Docker Harbour with Friends" />
                    </section>
                    <!-- /intro -->

                    <!-- cix -->
                    <section>
                        <h2>CIX Software</h2>
                        <img src="img/saas.png" width="auto" height="500" alt="CIX SaaS Diagram" />
                    </section>
                    <!-- /cix -->

                    <!-- old setup -->
                    <section>
                        <img src="img/old_setup.png" width="auto" height="600" alt="CIX old architecture" />
                    </section>
                    <!-- /old setup -->

                    <!-- new setup -->
                    <section>
                        <img src="img/new_setup.png" width="auto" height="500" alt="CIX new architecture" />
                    </section>
                    <!-- /new setup -->

                    <!-- why it's better -->
                    <section>
                        <h2>Why is the second one better?</h2>
                        <div class="fragment">
                            <strong>Resiliency</strong>
                            If one server goes down, we don't lose the API
                            <hr />
                        </div>
                        <div class="fragment">
                            <strong>Load Balancing</strong>
                            We now have multiple servers all able to handle requests instead of one
                            <hr />
                        </div>
                        <div class="fragment">
                            <strong>Fragmentation</strong>
                            If all the servers go down, we lose a single application, not all of them*
                            <hr />
                        </div>
                    </section>
                    <!-- /why it's better -->

                    <!-- speed increase -->
                    <section>
                        <h2>Speed Increase</h2>
                        <div class="fragment">
                            We needed to test that our system actually made an improvement.
                            <hr />
                        </div>
                        <div class="fragment">
                            List 100 Users from Py2 Live and Py3 Stage APIs one million times, calculate average time locally.
                            <hr />
                        </div>
                        <div class="fragment">
                            Speed increase from Python2 to Python3; <strong class="fragment">57x</strong>
                            <hr />
                        </div>
                    </section>
                    <!-- /speed increase -->

                    <!-- speed increase cont -->
                    <section>
                        <h2>Speed Increase (cont'd)</h2>
                        <div class="fragment">
                            Speed increase mostly due to architectural changes.
                            <hr />
                        </div>
                        <div class="fragment">
                            Original API running as monolith on single server.
                            <hr />
                        </div>
                        <div class="fragment">
                            New API running as clusters of smaller servers with load balancing.
                            <hr />
                        </div>
                    </section>
                    <!-- /speed increase cont-->

                    <!-- old deployment -->
                    <section>
                        <h2>Old Deployment System</h2>
                        <div class="fragment">
                            Gitlab CI automates deployment when code is pushed to specific branches.
                            <hr />
                        </div>
                        <div class="fragment">
                            Old method of deployment; <code>fabric</code>
                            <hr />
                        </div>
                        <div class="fragment">
                            SSH onto appropriate server, <code>git fetch origin</code>, and <code>git reset --hard &lt;branch&gt;</code>
                            <hr />
                        </div>
                        <div class="fragment">
                            Most of the time, deployment scripts did not contain a job to update requirements
                            <hr />
                        </div>
                    </section>
                    <!-- /old deployment -->

                    <!-- new deployment -->
                    <section>
                        <strong>New Deployment System</strong>
                        <div class="fragment">
                            Deployment still automated but handled differently
                            <hr />
                        </div>
                        <div class="fragment">
                            Gitlab CI triggers Docker builds from specific branches
                            <hr />
                        </div>
                        <div class="fragment">
                            After the image(s) are built, we deploy them to the appropriate cluster(s)
                            <hr />
                        </div>
                        <div class="fragment">
                            Rolling release on the cluster; new images brought up before bringing down old ones
                            <hr />
                        </div>
                    </section>
                    <!-- /new deployment -->
                </section>
                <!-- /trade secrets -->

                <!-- so how do I deploy using Docker -->
                <section>
                    <h3>I've Dockerised my Application...</h3>
                    <div class="fragment">
                        How and where do I deploy it?
                        <hr />
                    </div>
                    <div class="fragment">
                        Keep your eyes on <a href="https://github.com/UCCNetworkingSociety/Windlass" target="_blank">this project</a> for Netsoc's own <abbr title="Containers as a Service">CaaS</abbr> platform
                        <hr />
                    </div>
                    <div class="fragment">
                        Other cloud providers support containers but as far as I can tell, there are no free trials
                        <hr />
                    </div>
                    <div class="fragment">
                        If you're really anxious to deploy something, ask the lovely NetSoc SysAdmins where Windlass is c:
                        <hr />
                    </div>
                </section>
                <!-- /so how do I deploy using Docker -->

                <!-- Roadmap -->
                <section>
                    <h2>Conclusions</h2>
                    <div class="fragment">
                        Containers vs VMs
                        <hr />
                    </div>
                    <div class="fragment">
                        <strong><em>T E N T S</em></strong>
                        <hr />
                    </div>
                    <div class="fragment">
                        Installation
                        <hr />
                    </div>
                    <div class="fragment">
                        Docker Hub
                        <hr />
                    </div>
                    <div class="fragment">
                        How to build your image
                        <hr />
                    </div>
                    <div class="fragment">
                        Docker Compose
                        <hr />
                    </div>
                </section>

                <section>
                    <h2>Conclusions (cont'd)</h2>
                    <div class="fragment">
                        Kubernetes kinda
                        <hr />
                    </div>
                    <div class="fragment">
                        Company secrets that my boss let me share
                        <hr />
                    </div>
                    <div class="fragment">
                        Another cool Netsoc project on the way
                        <hr />
                    </div>
                </section>
                <!-- /Roadmap -->

                <section>
                    What are your questions?
                    <pre><code data-trim data-language="Dockerfile">
                        FROM docker-talk:audience
                        RUN answer-questions.sh
                    </code></pre>
                </section>

                <section>
                    <h1>Thank you!</h1>
                    <br />
                    <h3>Slides:</h3> <a href="http://freyamade.netsoc.co/techtalks/docker" target="_blank">freyamade.netsoc.co/techtalks/docker</a>
                    <br />
                    <h3>Code:</h3> <a href="https://github.com/freyamade/netsoc-docker-talk" target="_blank">freyamade/netsoc-docker-talk</a>
                    <br />
                    <h3>Example:</h3> <a href="https://github.com/freyamade/techtalks-flask" target="_blank">freyamade/techtalks-flask</a>
                </section>
            </div>
        </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.min.js"></script>

        <script>
            // More info about config & dependencies:
            // - https://github.com/hakimel/reveal.js#configuration
            // - https://github.com/hakimel/reveal.js#dependencies
            Reveal.initialize({
                controls: true,
                history: true,
                dependencies: [
                    { src: 'plugin/markdown/marked.js' },
                    { src: 'plugin/markdown/markdown.js' },
                    { src: 'plugin/notes/notes.js', async: true },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
                ]
            });
        </script>
    </body>
</html>
